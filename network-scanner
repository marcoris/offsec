#!/bin/bash

# Fast network scanner for open ports to get the best results.

tools_list=(
	rustscan
	nmap
)

# Function to check if a command exists
for tool in "${tools_list[@]}"; do
    if ! command -v "$tool" &>/dev/null; then
        echo "$tool is not installed."
        exit 0
    fi
done

read -p "Enter the target (IP, domain, or subnet): " target

PS3="Choose an option: "
options=(
    "RustScan -> Nmap: Scan OS, service name, and port"
    "RustScan -> Nmap: Scan for vulnerabilities"
    "RustScan -> Nmap: Full combined scan"
    "RustScan -> Nmap: Scan specific ports"
    "RustScan only: Fast port scan"
    "Nmap without RustScan"
    "Exit"
)

select opt in "${options[@]}"; do
    case $REPLY in
        1) 
            echo "Running RustScan for initial port scan..."
            ports=$(rustscan -a "$target" --range 1-65535 -g | awk -F'[][]' '{print $2}' | tr ',' '\n' | sort -n | tr '\n' ',' | sed 's/,$//')
            echo "Detected open ports: $ports"
            echo "Running Nmap on detected ports..."
            nmap -A -p "$ports" "$target"
            break
            ;;
        2)
            echo "Running RustScan for initial port scan..."
            ports=$(rustscan -a "$target" --range 1-65535 -g | awk -F'[][]' '{print $2}' | tr ',' '\n' | sort -n | tr '\n' ',' | sed 's/,$//')
            echo "Detected open ports: $ports"
            echo "Running Nmap vulnerability scan on detected ports..."
            nmap -p "$ports" --script=vuln "$target"
            break
            ;;
        3)
            echo "Running RustScan for initial port scan..."
            ports=$(rustscan -a "$target" --range 1-65535 -g | awk -F'[][]' '{print $2}' | tr ',' '\n' | sort -n | tr '\n' ',' | sed 's/,$//')
            echo "Detected open ports: $ports"
            echo "Running combined Nmap scan on detected ports..."
            nmap -A -p "$ports" --script=vuln "$target"
            break
            ;;
        4)
            read -p "Enter specific ports (e.g., 22,80): " ports
            echo "Running Nmap on specific ports..."
            nmap -p "$ports" "$target"
            break
            ;;
        5)
            echo "Running RustScan for a quick port scan..."
            rustscan -a "$target"
            break
            ;;
        6)
            echo "Running Nmap without RustScan..."
            read -p "Enter Nmap options (e.g., -A -p-): " nmap_options
            nmap $nmap_options "$target"
            break
            ;;
        7)
            echo "Exiting..."
            exit 0
            ;;
        *)
            echo "Invalid option. Try again."
            ;;
    esac
done
